<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TYPE â€” å¿«é€Ÿå®šæ—¶æ‰“å­—æ¸¸æˆåˆé›†</title>
  <style>
    :root{--bg:#0b1020;--accent:#ffd166;--danger:#ff5c5c;--ok:#6ee7b7}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:linear-gradient(180deg,#071029 0%, #0b1020 100%);color:#e8eef6;display:flex;justify-content:center;align-items:center;}
    .app{width:960px;max-width:96vw;height:90vh;display:flex;flex-direction:column;gap:12px;}

    .scene{position:relative;border-radius:12px;overflow:hidden;flex:6;display:flex;flex-direction:column;align-items:center;justify-content:center;}
    .scene.theme-bomb{background:linear-gradient(180deg,#1b0f0f,#2b1212)}
    .scene.theme-rocket{background:linear-gradient(180deg,#041126,#09203a)}
    .scene.theme-sub{background:linear-gradient(180deg,#001323,#00324a)}
    .scene.theme-zombie{background:linear-gradient(180deg,#071316,#1b1a18)}
    .scene.theme-volcano{background:linear-gradient(180deg,#2b0b00,#3a1a0d)}
    .scene.theme-space{background:linear-gradient(180deg,#030217,#0b1632)}
    .scene.theme-magic{background:linear-gradient(180deg,#0b0920,#241040)}
    .scene.theme-skydive{background:linear-gradient(180deg,#0b2238,#5aa)}

    .panel{flex:4;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(0,0,0,0.12));border-radius:12px;padding:18px;display:flex;flex-direction:column;gap:12px;}

    .hintFlash{position:absolute;inset:18px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:28px;font-weight:600;background:rgba(0,0,0,0.25);backdrop-filter:blur(3px);z-index:5}
    .chinese{position:relative;z-index:5;font-size:36px;font-weight:700;text-align:center;margin-top:40px}
    .countdownBig{position:absolute;right:18px;top:18px;background:rgba(0,0,0,0.25);padding:10px 14px;border-radius:10px;font-weight:700;font-size:22px;z-index:6;} /* âœ… ç¡®ä¿å€’è®¡æ—¶åœ¨å›¾ç‰‡ä¸Šæ–¹ */
    .meter{position:absolute;left:18px;top:18px;background:rgba(255,255,255,0.03);padding:6px 10px;border-radius:10px;font-weight:600;z-index:6;}

    .wordTarget{font-size:18px;color:#bcd0e8}
    .feedback{height:40px;display:flex;align-items:center;justify-content:center;font-size:18px}
    .feedback.success{color:var(--ok)}
    .feedback.fail{color:var(--danger)}

    .inputWrap{display:flex;flex-direction:column;gap:12px;align-items:center}
    #letters{display:flex;gap:6px;flex-wrap:nowrap;justify-content:center;margin-top:10px}

    .btn{padding:10px 12px;border-radius:10px;background:var(--accent);color:#0b1020;font-weight:700;border:none;cursor:pointer}

    .letterInput {
      width:28px;
      height:36px;
      border-radius:6px;
      display:flex;
      align-items:center;
      justify-content:center;
      background:rgba(255,255,255,0.03);
      padding:6px 8px;
      font-weight:700;
      color:#eaf4ff;
      font-size:18px;
      text-transform:lowercase;
      text-align:center;
      outline:none;
      border:none;
      animation:pulseGlow 2s ease-in-out infinite;
    }

    @keyframes pulseGlow {
      0%,100% { box-shadow:0 0 4px rgba(255,255,255,0.3); }
      50% { box-shadow:0 0 12px rgba(255,255,255,0.6); }
    }

    .letterInput.correct{background:rgba(110,231,183,0.15);color:var(--ok)}
    .letterInput.wrong{background:rgba(255,92,92,0.12);color:var(--danger)}

    .explode{animation:explode 700ms ease-out forwards}
    @keyframes explode{0%{transform:scale(1);opacity:1}100%{transform:scale(1.6);opacity:0}}
    .rocketLift{animation:lift 1200ms ease-in forwards}
    @keyframes lift{0%{transform:translateY(0)}100%{transform:translateY(-380px);opacity:0}}

    .bgLayer{position:absolute;top:0;left:0;width:100%;height:100%;background-size:cover;background-position:center center;z-index:0;opacity:1;transition:opacity 0.2s linear;}

    /* âœ… æ–°å¢é”™è¯è®°å½•åŒº */
    #wrongWords {
      font-size:13px;
      color:#ffb3b3;
      border-top:1px solid rgba(255,255,255,0.1);
      background: rgba(255, 255, 255, 0.15); /* æµ…è‰²åŠé€æ˜èƒŒæ™¯ */
      padding-top:6px;
      overflow:auto;
      max-height:60px;
    }
  </style>
</head>
<body>
  <div class="app">
    <div id="scene" class="scene theme-bomb">
      <div class="hintFlash" id="flash" style="display:none">flash</div>
      <div class="countdownBig" id="countdown">--</div>
      <div class="meter" id="themeLabel">Theme</div>
      <div style="position:relative;z-index:4">
        <div class="chinese" id="chinese">â€”â€”</div>
      </div>
      <div id="sceneEffect" style="position:absolute;left:0;right:0;bottom:10px;display:flex;justify-content:center;pointer-events:none"></div>
    </div>

    <div class="panel">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="font-size:13px;color:#bcd0e8">å·²è¿ç»­æˆåŠŸï¼š<span id="streak">0</span></div>
      </div>

      <div class="inputWrap">
        <button id="startBtn" class="btn">å¼€å§‹</button>
        <div id="letters"></div>
      </div>

      <div class="feedback" id="feedback">ç‚¹å‡»â€œå¼€å§‹â€éšæœºå¼€å§‹ä¸€å±€</div>

      <div style="font-size:13px;color:#9fb4d9">è¯´æ˜ï¼šå…ˆé—ªä¸¤ç§’ä¸­è‹±æ–‡ï¼Œç„¶ååªæ˜¾ç¤ºä¸­æ–‡ã€‚å€’è®¡æ—¶ç»“æŸå‰æ‹¼å†™æ­£ç¡®å¯è¿‡å…³ã€‚</div>

      <!-- âœ… æ–°å¢é”™è¯è®°å½•åŒº -->
      <div id="wrongWords">é”™è¯è®°å½•ï¼š</div>
    </div>
  </div>

  <script>
    // âœ… éŸ³æ•ˆè®¾ç½®
    const successSound = new Audio('sounds/success.mp3');
    const failSounds = {
      bomb: new Audio('sounds/bomb_fail.mp3'),
      rocket: new Audio('sounds/rocket_fail.mp3'),
      sub: new Audio('sounds/sub_fail.mp3'),
      zombie: new Audio('sounds/zombie_fail.mp3'),
      volcano: new Audio('sounds/volcano_fail.mp3'),
      space: new Audio('sounds/space_fail.mp3'),
      magic: new Audio('sounds/magic_fail.mp3'),
      skydive: new Audio('sounds/skydive_fail.mp3')
    };

    const wrongWordsEl = document.getElementById('wrongWords');
    const WORDS=[["apple","è‹¹æœ"],["rocket","ç«ç®­"],["submarine","æ½œè‰‡"],["zombie","åƒµå°¸"],["volcano","ç«å±±"],["oxygen","æ°§æ°”"],["magic","é­”æ³•"],["parachute","é™è½ä¼"],["defuse","æ‹†é™¤"],["launch","å‘å°„"],["escape","é€ƒç”Ÿ"],["repair","ä¿®ç†"],["rescue","æ•‘æ´"],["danger","å±é™©"],["timer","å®šæ—¶å™¨"]];
    const THEMES=[{id:'bomb',name:'æ‹†é™¤ç‚¸å¼¹',time:10},{id:'rocket',name:'ç«ç®­å‘å°„',time:8},{id:'sub',name:'æ°´ä¸‹é€ƒç”Ÿ',time:10},{id:'zombie',name:'åƒµå°¸æ¥è¢­',time:6},{id:'volcano',name:'ç«å±±é€ƒè·‘',time:7},{id:'space',name:'å¤ªç©ºä¿®å¤',time:9},{id:'magic',name:'é­”æ³•å¯¹å†³',time:8},{id:'skydive',name:'é«˜ç©ºå è½',time:10}];

    const scene=document.getElementById('scene'),
          flash=document.getElementById('flash'),
          chineseEl=document.getElementById('chinese'),
          countdownEl=document.getElementById('countdown'),
          themeLabel=document.getElementById('themeLabel'),
          lettersWrap=document.getElementById('letters'),
          startBtn=document.getElementById('startBtn'),
          feedback=document.getElementById('feedback'),
          sceneEffect=document.getElementById('sceneEffect'),
          streakEl=document.getElementById('streak');

    let current=null,timer=null,remain=0,streak=0;

    // ---------- é¢„è®¾ï¼ˆä¸å¼ºåˆ¶ä½¿ç”¨ï¼‰: ä¸»é¢˜èƒŒæ™¯è·¯å¾„ï¼ˆä½ å¯ä»¥ç•™ç€æˆ–æ›¿æ¢ä¸ºä½ çš„è·¯å¾„ï¼‰ ----------
    const THEME_IMAGES = {
      bomb: ['images/bomb1.png','images/bomb2.png','images/bomb3.png'],
      rocket: ['images/rocket1.png','images/rocket2.png','images/rocket3.png'],
      sub: ['images/sub1.png','images/sub2.png','images/sub3.png'],
      zombie: ['images/zombie1.png','images/zombie2.png','images/zombie3.png'],
      volcano: ['images/volcano1.png','images/volcano2.png','images/volcano3.png'],
      space: ['images/space1.png','images/space2.png','images/space3.png'],
      magic: ['images/magic1.png','images/magic2.png','images/magic3.png'],
      skydive: ['images/skydive1.png','images/skydive2.png','images/skydive3.png']
    };
    // --------------------------------------------------------------------------------


    // æ–°å¢ï¼šèƒŒæ™¯åŠ¨ç”»æ§åˆ¶å¼•ç”¨
    let _bgFrame = null;
    let _bgBase = null;
    let _bgNext = null;

    // ç®€å•çš„å›¾ç‰‡å­˜åœ¨æ£€æµ‹ï¼ˆè¿”å› Promise<boolean>ï¼‰
    function imageExists(src){
      return new Promise(resolve=>{
        const img=new Image();
        img.onload = ()=> resolve(true);
        img.onerror = ()=> resolve(false);
        img.src = src;
      });
    }

    // è‡ªåŠ¨æ£€æµ‹å¹¶è¿”å›å›¾ç‰‡æ•°ç»„ï¼ˆä¼šå°è¯•è‹¥å¹²å‘½åè§„åˆ™ï¼‰ï¼Œæœ€å¤šå°è¯• maxIndex ä¸ªåºå·
    async function detectImagesForTheme(themeId, maxIndex = 8){
      const exts = ['png','jpg','jpeg','webp'];
      const results = [];
      let consecutiveMiss = 0;
      for(let i=1;i<=maxIndex && consecutiveMiss < 3;i++){
        let found = false;
        // å°è¯•å¤šç§å¸¸è§æ–‡ä»¶åå¸ƒå±€
        const patterns = [
          `images/${themeId}${i}`,     // images/bomb1.png
          `images/${themeId}/${i}`,    // images/bomb/1.png
          `images/${themeId}_${i}`,    // images/bomb_1.png
          `images/${i}`,               // images/1.png ï¼ˆä¸å¤ªå¸¸è§ï¼‰
        ];
        for(const p of patterns){
          for(const ext of exts){
            const path = `${p}.${ext}`;
            // eslint-disable-next-line no-await-in-loop
            const ok = await imageExists(path);
            if(ok){ results.push(path); found = true; break; }
          }
          if(found) break;
        }
        if(!found) consecutiveMiss++; else consecutiveMiss = 0;
      }
      return results;
    }

    // å¯åŠ¨å¹³æ»‘èƒŒæ™¯æ¸å˜ï¼ˆä½¿ç”¨å·²å‡†å¤‡å¥½çš„ images æ•°ç»„ï¼‰
    function startBackgroundAnimationWithImages(images, durationSec){
      stopBackgroundAnimation(); // å…ˆåœæ­¢æ—§åŠ¨ç”»

      if(!images || images.length === 0) return;

      // åˆ›å»ºæˆ–å¤ç”¨ä¸¤å±‚èƒŒæ™¯
      _bgBase = document.createElement('div');
      _bgBase.className = 'bgLayer';
      _bgBase.style.zIndex = 0;
      _bgBase.style.opacity = 1;
      _bgBase.style.backgroundImage = `url('${images[0]}')`;
      scene.appendChild(_bgBase);

      _bgNext = document.createElement('div');
      _bgNext.className = 'bgLayer';
      _bgNext.style.zIndex = 0;
      _bgNext.style.opacity = 0;
      _bgNext.style.backgroundImage = images.length > 1 ? `url('${images[1]}')` : `url('${images[0]}')`;
      scene.appendChild(_bgNext);

      const start = performance.now();
      const lastIndex = images.length - 1;

      function animate(now){
        const elapsed = now - start;
        const t = Math.min(elapsed / (durationSec * 1000), 1); // 0..1
        const exactIndex = t * lastIndex;
        const lower = Math.floor(exactIndex);
        const upper = Math.min(lower + 1, lastIndex);
        const frac = exactIndex - lower;

        // æ›´æ–°èƒŒæ™¯å›¾å±‚å†…å®¹ï¼ˆé¿å…é¢‘ç¹åˆ›å»ºèŠ‚ç‚¹ï¼‰
        _bgBase.style.backgroundImage = `url('${images[lower]}')`;
        _bgNext.style.backgroundImage = `url('${images[upper]}')`;
        _bgNext.style.opacity = frac;

        if(t < 1){
          _bgFrame = requestAnimationFrame(animate);
        } else {
          // ç»“æŸæ—¶ä¿ç•™æœ€åä¸€å¸§ï¼Œæ¸…ç†å¦ä¸€å±‚
          _bgBase.style.backgroundImage = `url('${images[lastIndex]}')`;
          _bgNext.style.opacity = 0;
          // ä¸ç«‹å³ç§»é™¤ï¼Œè®© DOM ç»“æ„ç¨³å®šï¼›ä¸‹ä¸€æ¬¡ start ä¼š cleanup
          _bgFrame = null;
        }
      }

      _bgFrame = requestAnimationFrame(animate);
    }

    // åœæ­¢å¹¶ç§»é™¤èƒŒæ™¯åŠ¨ç”»å±‚
    function stopBackgroundAnimation(){
      if(_bgFrame) { cancelAnimationFrame(_bgFrame); _bgFrame = null; }
      if(_bgBase){ try{ scene.removeChild(_bgBase); }catch(e){} _bgBase = null; }
      if(_bgNext){ try{ scene.removeChild(_bgNext); }catch(e){} _bgNext = null; }
    }

    // å¦‚æœæœ‰æ£€æµ‹åˆ°å›¾ç‰‡ï¼Œä½¿ç”¨æ£€æµ‹ç»“æœï¼›å¦åˆ™ä½¿ç”¨é¢„è®¾ THEME_IMAGES ä½œä¸ºå›é€€
    async function detectAndStartBg(themeId, durationSec){
      // å…ˆå°è¯•æ£€æµ‹ï¼ˆå¼‚æ­¥ï¼‰ï¼Œå¦‚æœå¤±è´¥åˆ™ç”¨é¢„è®¾
      const detected = await detectImagesForTheme(themeId, 8);
      const images = (detected && detected.length) ? detected : (THEME_IMAGES[themeId] || []);
      if(images && images.length) {
        startBackgroundAnimationWithImages(images, durationSec);
      } else {
        // æ²¡å›¾ç‰‡å¯ç”¨æ—¶ï¼Œç¡®ä¿æ²¡æœ‰æ®‹ç•™åŠ¨ç”»ï¼ˆä¿ç•™åŸæœ¬çš„ä¸»é¢˜æ¸å˜æ ·å¼ï¼‰
        stopBackgroundAnimation();
      }
    }

    function pickRandomWord(){return WORDS[Math.floor(Math.random()*WORDS.length)];}
    function pickRandomTheme(){return THEMES[Math.floor(Math.random()*THEMES.length)];}
    function setThemeVisual(themeId){scene.className='scene theme-'+themeId;themeLabel.textContent=THEMES.find(t=>t.id===themeId).name;}
    function showFlash(eng,chi){flash.style.display='flex';flash.textContent=eng+'  -  '+chi;setTimeout(()=>{flash.style.display='none';},2000);}

    function renderLettersInputs(target){
      lettersWrap.innerHTML='';
      for(let i=0;i<target.length;i++){
        const input=document.createElement('input');
        input.className='letterInput';
        input.maxLength=1;
        lettersWrap.appendChild(input);
      }
      const inputs=lettersWrap.querySelectorAll('input');
      inputs.forEach((input,idx)=>{
        input.addEventListener('input',e=>{
          const val=e.target.value.toLowerCase();
          if(val && idx<inputs.length-1)inputs[idx+1].focus();
          checkProgress();
        });
        input.addEventListener('keydown',e=>{
          if(e.key==='Backspace' && !input.value && idx>0){inputs[idx-1].focus();}
          if(e.key==='Enter'){checkProgress(); onTimeUp();}
        });
      });
      inputs[0].focus();
    }

    function startRound(){
      feedback.textContent='å‡†å¤‡ä¸­...';
      const [eng,chi]=pickRandomWord();
      const theme=pickRandomTheme();
      current={eng,chi,theme};
      setThemeVisual(theme.id);
      showFlash(eng,chi);
      chineseEl.textContent=chi;
      setTimeout(()=>{
        renderLettersInputs(eng);
        feedback.textContent='å¼€å§‹æ‹¼å†™...';
        remain=theme.time;
        countdownEl.textContent=remain+'s';
        if(timer) { clearInterval(timer); timer=null; }
        // åœæ­¢æ—§çš„èƒŒæ™¯åŠ¨ç”»ï¼ˆå¦‚æœæœ‰ï¼‰
        stopBackgroundAnimation();

        // å¯åŠ¨æ–°çš„è®¡æ—¶å™¨
        timer=setInterval(()=>{
          if(remain>0){
            remain-=1;
            countdownEl.textContent=remain+'s';
            // ï¼ˆä¸å†æ¯ç§’åˆ‡æ¢å›¾ç‰‡ï¼‰â€”â€”èƒŒæ™¯åŠ¨ç”»ç”± detectAndStartBg ä¸€æ¬¡æ€§å¯åŠ¨å¹¶æ ¹æ®æ€»æ—¶é•¿å¹³æ»‘æ’­æ”¾
          } else {
            clearInterval(timer);
            timer=null;
            countdownEl.textContent='0s';
            onTimeUp();
          }
        },1000);

        // å¼‚æ­¥æ£€æµ‹å¹¶å¯åŠ¨èƒŒæ™¯å¹³æ»‘åŠ¨ç”»ï¼ˆä¸ä¼šé˜»å¡ä¸»æµç¨‹ï¼‰
        detectAndStartBg(current.theme.id, current.theme.time);

      },2000);
    }

    function getTypedWord(){
      return Array.from(lettersWrap.querySelectorAll('input')).map(i=>i.value).join('');
    }

    function checkProgress(){
      const typed = getTypedWord();
      const target = current.eng;
      const inputs = lettersWrap.querySelectorAll('input');

      // æ¯æ¬¡è¾“å…¥æ—¶ï¼Œå¦‚æœä¹‹å‰æ ‡è®°è¿‡é”™è¯ï¼Œä½†ç°åœ¨æ‹¼å†™æ­£ç¡®ï¼Œæ¸…é™¤é”™è¯è®°å½•æ ‡è®°
      if(current.wrongRecorded && typed.toLowerCase() === target.toLowerCase()){
        current.wrongRecorded = false;
      }

      for(let i=0;i<inputs.length;i++){
        inputs[i].classList.remove('correct','wrong');
        if(i<typed.length){
          if(typed[i].toLowerCase()===target[i].toLowerCase()) inputs[i].classList.add('correct');
          else inputs[i].classList.add('wrong');
        }
      }

      if(typed.toLowerCase() === target.toLowerCase()){
        if(timer){ clearInterval(timer); timer=null; }
        onSuccess();
      }
    }

    function onTimeUp(){
      const typed=getTypedWord();
      if(typed.toLowerCase()===current.eng.toLowerCase())onSuccess();
      else onFail();
    }

    function onSuccess(){ 
      // æ–°å¢ï¼šåœæ­¢èƒŒæ™¯åŠ¨ç”»ï¼Œä¿æŒåŸæœ‰é€»è¾‘ä¸å˜
      stopBackgroundAnimation();
      feedback.className='feedback success';feedback.textContent='æˆåŠŸï¼è¿‡å…³ã€‚';streak+=1;streakEl.textContent=streak;runEffect(true);
    }
    function onFail(){ 
      // æ–°å¢ï¼šåœæ­¢èƒŒæ™¯åŠ¨ç”»ï¼Œä¿æŒåŸæœ‰é€»è¾‘ä¸å˜
      stopBackgroundAnimation();
      feedback.className='feedback fail';feedback.textContent='å¤±è´¥...è¶…æ—¶æˆ–æ‹¼å†™é”™è¯¯';streak=0;streakEl.textContent=streak;runEffect(false);
    }

    function runEffect(success){
    sceneEffect.innerHTML = '';
    const theme = current.theme.id;

    // ä¼˜å…ˆæ˜¾ç¤ºå›¾ç‰‡
    const THEME_EFFECT_IMAGES = {
      bomb: { success: 'images/bomb_success.png', fail: 'images/bomb_fail.png' },
      rocket: { success: 'images/rocket_success.png', fail: 'images/rocket_fail.png' },
      sub: { success: 'images/sub_success.png', fail: 'images/sub_fail.png' },
      zombie: { success: 'images/zombie_success.png', fail: 'images/zombie_fail.png' },
      volcano: { success: 'images/volcano_success.png', fail: 'images/volcano_fail.png' },
      space: { success: 'images/space_success.png', fail: 'images/space_fail.png' },
      magic: { success: 'images/magic_success.png', fail: 'images/magic_fail.png' },
      skydive: { success: 'images/skydive_success.png', fail: 'images/skydive_fail.png' }
    };

    if(THEME_EFFECT_IMAGES[theme]){
      const img = document.createElement('img');
      img.src = success ? THEME_EFFECT_IMAGES[theme].success : THEME_EFFECT_IMAGES[theme].fail;
      img.style.maxWidth = '120px';
      img.style.maxHeight = '120px';
      img.style.borderRadius = '12px';
      img.style.boxShadow = '0 6px 30px rgba(0,0,0,.6)';
      sceneEffect.appendChild(img);
    } else {
      // fallback æ–‡å­—/emoji
      if(theme==='bomb'){const bomb=document.createElement('div');bomb.style.width='120px';bomb.style.height='120px';bomb.style.borderRadius='50%';bomb.style.background='radial-gradient(circle,#ff7b7b,#8b0a0a)';bomb.style.display='flex';bomb.style.alignItems='center';bomb.style.justifyContent='center';bomb.style.fontWeight='700';bomb.style.boxShadow='0 6px 30px rgba(0,0,0,.6)';bomb.textContent=success?'SAFE':'BOOM';if(!success){bomb.classList.add('explode');}sceneEffect.appendChild(bomb);}
      else if(theme==='rocket'){const r=document.createElement('div');r.textContent='ğŸš€';r.style.fontSize='64px';if(success)r.classList.add('rocketLift');sceneEffect.appendChild(r);}
      else if(theme==='sub'){const s=document.createElement('div');s.textContent=success?'ğŸš¿ æ’æ°´å®Œæˆ':'ğŸŒŠ æ·¹æ²¡';s.style.fontSize='28px';sceneEffect.appendChild(s);}
      else if(theme==='zombie'){const z=document.createElement('div');z.textContent=success?'âœ¨ æŠ¤ç¬¦ç‚¹äº®':'ğŸ§Ÿâ€â™‚ï¸ åƒµå°¸æ¥è¢­';z.style.fontSize='28px';sceneEffect.appendChild(z);}
      else if(theme==='volcano'){const v=document.createElement('div');v.textContent=success?'ğŸƒâ€â™€ï¸ è·‘ä¸Šå®‰å…¨å²©çŸ³':'ğŸŒ‹ å²©æµ†çˆ†å‘';v.style.fontSize='28px';sceneEffect.appendChild(v);}
      else if(theme==='space'){const sp=document.createElement('div');sp.textContent=success?'ğŸ”§ ä¿®å¤å®Œæˆ':'ğŸ«§ æ°§æ°”è€—å°½';sp.style.fontSize='28px';sceneEffect.appendChild(sp);}
      else if(theme==='magic'){const m=document.createElement('div');m.textContent=success?'âœ¨ å’’è¯­æˆåŠŸ':'âš¡ åå™¬';m.style.fontSize='28px';sceneEffect.appendChild(m);}
      else if(theme==='skydive'){const sd=document.createElement('div');sd.textContent=success?'ğŸª‚ é™è½ä¼æ‰“å¼€':'ğŸ’¥ å è½å¤±è´¥';sd.style.fontSize='28px';sceneEffect.appendChild(sd);}
    }
  }


    startBtn.addEventListener('click',()=>{sceneEffect.innerHTML='';feedback.className='feedback';feedback.textContent='å‡†å¤‡...';startRound();});


    // è¦†ç›– onSuccess / onFail æ’­æ”¾éŸ³æ•ˆ + è®°å½•é”™è¯
    const oldOnSuccess = onSuccess;
    const oldOnFail = onFail;

    onSuccess = function(){
      oldOnSuccess();
      successSound.currentTime = 0;
      successSound.play();
    };

    onFail = function(){
      oldOnFail(); // ä¿ç•™åŸæœ‰èƒŒæ™¯åŠ¨ç”»ã€UI é€»è¾‘
      const themeId = current.theme.id;
      const audio = failSounds[themeId];
      if(audio){
        audio.currentTime = 0;
        audio.play();
      }

      // âœ… åªè®°å½•ä¸€æ¬¡é”™è¯ï¼Œä¸”ä¿è¯ç”¨æˆ·æ”¹æ­£åä¸å†è®°å½•
      if(!current.wrongRecorded){
        const typed = getTypedWord();
        if(typed.toLowerCase() !== current.eng.toLowerCase()){ // åªæœ‰çœŸæ­£æ‹¼é”™æ‰è®°å½•
          const word = current.eng;
          if(word){
            const item = document.createElement('div');
            item.textContent = 'âŒ ' + word;
            wrongWordsEl.appendChild(item);
          }
          current.wrongRecorded = true; // æ ‡è®°å·²è®°å½•
        }
      }
    };
  </script>
</body>
</html>
