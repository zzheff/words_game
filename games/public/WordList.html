<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>é€‰æ‹©è¯è¡¨</title>
<style>
  :root {
    --bg: #f3f7fb;
    --card: #fff;
    --accent: #5b9bd5;
    --accent2: #4caf50;
    --shadow: 0 4px 10px rgba(0,0,0,0.08);
    --font: "Helvetica Neue", "PingFang SC", "Microsoft YaHei", sans-serif;
  }
  body { background: var(--bg); font-family: var(--font); margin: 0; padding: 20px; }
  h1 { text-align: center; color: #333; }
  .container { max-width: 700px; margin: 0 auto; background: var(--card); box-shadow: var(--shadow); border-radius: 16px; padding: 20px; }
  .wordlist, .builtin-list { display: flex; flex-wrap: wrap; gap: 10px; }
  .wordlist button, .builtin-list button { flex: 1 1 45%; background: var(--accent); color: white; border: none; border-radius: 8px; padding: 10px; cursor: pointer; font-size: 16px; transition: 0.2s; }
  .wordlist button:hover, .builtin-list button:hover { opacity: 0.85; }
  .custom-list { margin-top: 20px; }
  .custom-list h2 { font-size: 18px; margin-bottom: 8px; }
  input, textarea { width: 100%; padding: 8px; margin-top: 6px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px; }
  button.create { background: var(--accent2); color: white; border: none; padding: 10px 20px; margin-top: 10px; border-radius: 8px; cursor: pointer; }
  .lists { margin-top: 20px; }
  .lists ul { list-style: none; padding: 0; }
  .lists li { background: #eef5ff; border-radius: 6px; padding: 8px 10px; margin-bottom: 5px; display: flex; justify-content: space-between; }
  .lists li span { color: #333; }
  .lists li button { background: #ff6666; border: none; color: white; border-radius: 6px; padding: 4px 8px; cursor: pointer; }
</style>
</head>
<body>

<h1>é€‰æ‹©æˆ–åˆ›å»ºè¯è¡¨</h1>
<div class="container">
  <!-- å†…ç½®è¯è¡¨ -->
  <h2>ğŸ“˜ å†…ç½®è¯è¡¨</h2>
  <div class="builtin-list" id="builtinList"></div>

  <!-- è‡ªå®šä¹‰è¯è¡¨ -->
  <div class="custom-list">
    <h2>âœï¸ åˆ›å»ºè‡ªå®šä¹‰è¯è¡¨</h2>
    <input id="listName" placeholder="è¯·è¾“å…¥è¯è¡¨åç§°ï¼Œå¦‚â€˜Unit 1 å•è¯â€™">
    <textarea id="wordPairs" rows="5" placeholder="è¾“å…¥å•è¯å’Œä¸­æ–‡ï¼Œç”¨è‹±æ–‡é€—å·åˆ†éš”ï¼Œå¦‚ï¼šapple,è‹¹æœ\nbook,ä¹¦"></textarea>
    <button class="create" onclick="createCustomList()">åˆ›å»ºè¯è¡¨</button>
  </div>

  <div class="lists">
    <h2>ğŸ“š æˆ‘çš„è‡ªå®šä¹‰è¯è¡¨</h2>
    <ul id="customLists"></ul>
  </div>
</div>

<script>
  // ========== è®©é¡µé¢çŸ¥é“è·³å›å“ªé‡Œï¼ˆä¸»é¡µé¢å¸¦?returnURL=xxx è¿›æ¥ï¼‰ ==========
  const params = new URLSearchParams(window.location.search);
  const returnURL = params.get("returnURL") || "../index.html";

  // ====== è‡ªå®šä¹‰è¯è¡¨é€»è¾‘ ======
  const customLists = JSON.parse(localStorage.getItem('customLists') || '[]');
  const ul = document.getElementById('customLists');
  renderLists();

  function renderLists() {
    ul.innerHTML = '';
    customLists.forEach((list, index) => {
      const li = document.createElement('li');
      li.innerHTML = `
        <span>${list.name}ï¼ˆ${list.words.length} ä¸ªè¯ï¼‰</span>
        <div>
          <button onclick="loadList(${index})">åŠ è½½</button>
          <button onclick="deleteList(${index})">åˆ é™¤</button>
        </div>
      `;
      ul.appendChild(li);
    });
  }

  function createCustomList() {
    const name = document.getElementById('listName').value.trim();
    const raw = document.getElementById('wordPairs').value.trim();
    if (!name || !raw) return alert('è¯·è¾“å…¥è¯è¡¨åå’Œå•è¯å†…å®¹');

    const lines = raw.split('\n').map(l => l.split(',')).filter(a => a.length === 2);
    const words = lines.map(([en, cn]) => ({ en: en.trim(), cn: cn.trim() }));

    customLists.push({ name, words });
    localStorage.setItem('customLists', JSON.stringify(customLists));
    renderLists();
    alert('âœ… åˆ›å»ºæˆåŠŸ');
  }

  function deleteList(index) {
    if (confirm('ç¡®å®šåˆ é™¤è¿™ä¸ªè¯è¡¨å—ï¼Ÿ')) {
      customLists.splice(index, 1);
      localStorage.setItem('customLists', JSON.stringify(customLists));
      renderLists();
    }
  }

  // --- ğŸ“± åŠ è½½è¯è¡¨ â†’ ä¿å­˜åˆ° localStorage â†’ è·³å›ä¸»é¡µé¢ ---
  function loadList(index) {
    const list = customLists[index];
    const csvText = list.words.map(w => `${w.en},${w.cn}`).join('\n');

    localStorage.setItem("csv_data", csvText); // ç»™ä¸»é¡µé¢çš„æ•°æ®
    window.location.href = returnURL; // è¿”å›ä¸»é¡µé¢
  }


  // ========== å†…ç½®è¯è¡¨é€»è¾‘ ==========
  const builtinContainer = document.getElementById('builtinList');

  function loadBuiltIn() {
    const vocabData = [
      { name: "ğŸ§ æµ‹è¯•å•è¯", type: "file", path: "test.csv" }
    ];
    renderBuiltin(vocabData);
  }

  function renderBuiltin(items) {
    builtinContainer.innerHTML = '';
    items.forEach(item => {
      const btn = document.createElement('button');
      btn.textContent = item.name;

      btn.onclick = async () => {
        if (item.type === 'file') {
          try {
            const res = await fetch(item.path);
            if (!res.ok) throw new Error('æ–‡ä»¶æœªæ‰¾åˆ°');
            const text = await res.text();

            const lines = text.trim().split(/\r?\n/);
            const words = lines
              .map(line => line.split(','))
              .filter(a => a.length === 2)
              .map(([en, cn]) => ({ en: en.trim(), cn: cn.trim() }));

            // ğŸ“± ä¿å­˜å¹¶è·³å›ä¸»é¡µé¢
            const csvText = words.map(w => `${w.en},${w.cn}`).join('\n');
            localStorage.setItem("csv_data", csvText);
            window.location.href = returnURL;

          } catch (err) {
            alert('âŒ æ— æ³•åŠ è½½è¯åº“ï¼Œè¯·ç¡®ä¿æ–‡ä»¶å­˜åœ¨');
            console.error(err);
          }
        }
      };

      builtinContainer.appendChild(btn);
    });
  }

  loadBuiltIn();
</script>
</body>
</html>
