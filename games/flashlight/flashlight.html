<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>flashlight</title>
<style>
body,html{
  margin:0;
  padding:0;
  height:100%;
  background:#030720;
  font-family:Arial,sans-serif;
}

/* ä¿æŒèˆå°å……æ»¡å±å¹• */
.stage{
  position:relative;
  width:100%;
  height:100vh;
  overflow:hidden;
}
.scene{
  position:absolute;
  inset:0;
  background:#030720;
}

/* ====================== å…‰åœˆ ======================= */
.overlay {
  position:absolute;
  inset:0;
  pointer-events:none;
  z-index:5;
  background:transparent;
}
.overlay::before {
  content:'';
  position:absolute;
  left:var(--x,50%);
  top:var(--y,50%);
  width:150px;
  height:150px;
  transform:translate(-50%,-50%);
  border-radius:50%;
  background: radial-gradient(circle,
      rgba(255,255,0,0.6) 0%,
      rgba(255,255,0,0.2) 50%,
      rgba(255,255,0,0) 100%
  );
}

/* ====================== çƒ­ç‚¹ ======================= */
.hotspots{position:absolute;inset:0;z-index:10;}
.hotspot{position:absolute;}

.star{
  width:6px;
  height:6px;
  border-radius:50%;
  background:rgba(255,255,100,0.7);
  transform:translate(-50%,-50%) scale(1);
  box-shadow:0 0 3px rgba(255,255,150,0.8);
  z-index:10;
}

.word{
  position:absolute;
  transform:translate(-50%,-130%);
  white-space:nowrap;
  padding:6px 10px;
  background:#fff;
  color:#000;
  font-weight:bold;
  font-size:18px;
  border-radius:6px;
  box-shadow:0 3px 12px rgba(0,0,0,0.5);
  display:none;
  z-index:15;
}

/* ====================== æ§åˆ¶æŒ‰é’® ======================= */
.controls{
  position:absolute;
  top:10px;
  left:10px;
  display:flex;
  gap:10px;
  z-index:20;
}
.controls button{
  padding:6px 12px;
  border:none;
  border-radius:5px;
  background:#3a5f8f;
  color:#fff;
  cursor:pointer;
  font-size:14px;
}

/* ===================================================================
   ===============  ğŸŒŸ å“åº”å¼ï¼šæ‰‹æœºç«–å± / æ¨ªå± / PC  ==================
   =================================================================== */

/* ğŸ“± æ‰‹æœºç«–å±ï¼ˆå¸¸è§ï¼š375Ã—812 ä¹‹ç±»ï¼‰ */
@media (max-width: 600px) and (orientation: portrait) {

  .controls button {
    font-size: 12px;
    padding: 5px 10px;
  }

  .word {
    font-size: 14px;    /* å­—ä½“æ›´å° */
    padding: 4px 8px;
  }

  .overlay::before {
    width:130px;         /* å…‰åœˆç¼©å°ä¸€ç‚¹ */
    height:130px;
  }

  .star {
    width:5px;
    height:5px;
  }
}

/* ğŸ“± æ‰‹æœºæ¨ªå±ï¼ˆè§†é‡å˜å®½ï¼‰ */
@media (max-width: 900px) and (orientation: landscape) {

  .word {
    font-size: 16px;
    padding: 5px 9px;
  }

  .overlay::before {
    width:150px;        /* æ¨ªå±ç©ºé—´æ›´å¤§ï¼Œå…‰åœˆä¿æŒä¸­ç­‰ */
    height:150px;
  }

  .star {
    width:6px;
    height:6px;
  }
}

/* ğŸ’» ç”µè„‘ or å¤§å¹³æ¿ */
@media (min-width: 1200px) {

  .controls button {
    font-size:16px;
    padding:8px 14px;
  }

  .word {
    font-size:20px;
    padding: 8px 12px;
  }

  .overlay::before {
    width:200px;
    height:200px;       /* ç”µè„‘å…‰åœˆæ›´å¤§ */
  }

  .star {
    width:8px;
    height:8px;
  }
}
</style>
</head>
<body>
<div class="stage" id="stage">
  <div class="scene"></div>
  <div class="hotspots" id="hotspots"></div>
  <div class="overlay" id="overlay"></div>
  <div class="controls">
    <button id="importBtn">å¯¼å…¥å•è¯</button>
    <button id="refreshBtn">åˆ·æ–°å•è¯æ˜¾ç¤º</button>
  </div>
  <audio id="clickSound" src="click.mp3" preload="auto"></audio>
</div>

<script>
let HOTSPOTS = [];
const stage = document.getElementById('stage');
const hotspotsEl = document.getElementById('hotspots');
const overlay = document.getElementById('overlay');
const clickSound = document.getElementById('clickSound');

// ç”Ÿæˆä¸é‡å ä½ç½®
function generatePosition(existing, minDistance=80){
  let x,y,valid;
  for(let i=0;i<100;i++){
    x = Math.random()*80+10;
    y = Math.random()*80+10;
    valid = true;
    for(const h of existing){
      if(!h._el) continue;
      const hx = parseFloat(h._el.style.left);
      const hy = parseFloat(h._el.style.top);
      const dx = x - hx;
      const dy = y - hy;
      if(Math.hypot(dx*10, dy*10)<minDistance){
        valid = false;
        break;
      }
    }
    if(valid) break;
  }
  return {x,y};
}

// åˆ›å»ºçƒ­ç‚¹
function createHotspots(){
  hotspotsEl.innerHTML='';
  HOTSPOTS.forEach(h=>{
    const el = document.createElement('div');
    el.className='hotspot';
    const pos = generatePosition(HOTSPOTS);
    el.style.left = pos.x + '%';
    el.style.top = pos.y + '%';

    const word = document.createElement('div');
    word.className='word';
    word.textContent = Math.random()<0.5?h.chinese:h.english;
    el.appendChild(word);

    const star = document.createElement('div');
    star.className='star';
    el.appendChild(star);

    hotspotsEl.appendChild(el);
    h._el = el;
    h._wordEl = word;
    h._starEl = star;
    h.flickerPhase = Math.random()*Math.PI*2;
    h.flickerSpeed = 0.07 + Math.random()*0.07;
  });
}

// è®¾ç½®å…‰åœˆä½ç½®
function setSpot(xPct, yPct){
  overlay.style.setProperty('--x', xPct + '%');
  overlay.style.setProperty('--y', yPct + '%');
}

// æ£€æµ‹å…‰åœˆèŒƒå›´å†…çš„å•è¯
function checkIlluminated(clientX,clientY){
  const rect = stage.getBoundingClientRect();
  const spotRadius = 80;
  HOTSPOTS.forEach(h=>{
    const hx = rect.left + rect.width*(parseFloat(h._el.style.left)/100);
    const hy = rect.top + rect.height*(parseFloat(h._el.style.top)/100);
    const dist = Math.hypot(clientX-hx, clientY-hy);
    if(dist<=spotRadius){
      h._wordEl.style.display='block';
      h._starEl.style.display='none';
    }else{
      h._wordEl.style.display='none';
      h._starEl.style.display='block';
    }
  });
}

// é¼ æ ‡æˆ–è§¦æ‘¸ç§»åŠ¨
function handlePointer(x,y){
  const rect = stage.getBoundingClientRect();
  let xPct = ((x-rect.left)/rect.width)*100;
  let yPct = ((y-rect.top)/rect.height)*100;
  xPct = Math.max(0,Math.min(100,xPct));
  yPct = Math.max(0,Math.min(100,yPct));
  setSpot(xPct,yPct);
  checkIlluminated(x,y);
}

window.addEventListener('mousemove',e=>handlePointer(e.clientX,e.clientY));
window.addEventListener('touchmove',e=>{
  const t = e.touches[0]; if(!t) return;
  handlePointer(t.clientX,t.clientY);
});

// === ä¿®æ”¹åçš„å¯¼å…¥å•è¯é€»è¾‘ï¼ˆSPA æ•´é¡µè·³è½¬ï¼‰ ===
document.getElementById('importBtn').addEventListener('click', () => {
  // æ•´é¡µè·³è½¬åˆ°è¯è¡¨é¡µï¼Œå¹¶æŠŠå½“å‰é¡µé¢åœ°å€å½“ä½œ returnURL ä¼ è¿‡å»
  const returnURL = encodeURIComponent(window.location.pathname);
  window.location.href = `../public/WordList.html?returnURL=${returnURL}`;
});

// === flash é¡µé¢è½½å…¥åè‡ªåŠ¨æ£€æŸ¥æ˜¯å¦æœ‰è¯è¡¨æ•°æ® ===
window.addEventListener("DOMContentLoaded", () => {
  const csvText = localStorage.getItem("csv_data");
  if (!csvText) return;

  // ç”¨å®Œæ¸…é™¤
  localStorage.removeItem("csv_data");

  const lines = csvText.split(/\r?\n/).filter(l => l.trim() !== '');
  HOTSPOTS = [];

  lines.forEach(line => {
    const parts = line.split(',');
    let en = parts[0]?.trim() || '';
    let cn = parts[1]?.trim() || '';
    if (/[\u4e00-\u9fa5]/.test(en)) [en, cn] = [cn, en];
    if (en && cn) HOTSPOTS.push({ english: en, chinese: cn });
  });

  if (HOTSPOTS.length > 0) createHotspots();
});

// åˆ·æ–°å•è¯æ˜¾ç¤º
document.getElementById('refreshBtn').addEventListener('click',()=>{
  clickSound.currentTime=0; clickSound.play();
  HOTSPOTS.forEach(h=>{
    h._wordEl.textContent=Math.random()<0.5?h.chinese:h.english;
  });
});

// æ˜Ÿæ˜Ÿé—ªçƒåŠ¨ç”»
function animateStars(){
  HOTSPOTS.forEach(h=>{
    if(h._starEl && h._starEl.style.display!=='none'){
      h.flickerPhase += h.flickerSpeed;
      const opacity = 0.4 + 0.6*(Math.sin(h.flickerPhase)+1)/2;
      const scale = 0.7 + 0.6*(Math.sin(h.flickerPhase)+1)/2;
      h._starEl.style.opacity = opacity;
      h._starEl.style.transform = `translate(-50%,-50%) scale(${scale})`;
    }
  });
  requestAnimationFrame(animateStars);
}
requestAnimationFrame(animateStars);
</script>
</body>
</html>
